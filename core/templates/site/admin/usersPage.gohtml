{{ template "head" $ }}
    <div>[<a href="/admin">Admin:</a> <a href="/admin/users">(This page/Refresh)</a>]</div>
    <h2>Users</h2>
    <div style="margin-bottom: 20px;">
        <p>Manage registered users on the platform.</p>
        <p><strong>Usage:</strong></p>
        <ul>
            <li><strong>Search:</strong> Filter users by username/email query, role, or account status.</li>
            <li><strong>View Details:</strong> Click a User ID to view full profile details and grants.</li>
        </ul>
    </div>
    <form method="get">
        <input name="search" value="{{$.Search}}">
        <select name="role">
            <option value="">All Roles</option>
            {{- range $.Roles }}
            <option value="{{.Name}}" {{if eq $.Role .Name}}selected{{end}}>{{.Name}}</option>
            {{- end }}
        </select>
        <select name="status">
            <option value="">All Statuses</option>
            <option value="active" {{if eq $.Status "active"}}selected{{end}}>active</option>
            <option value="disabled" {{if eq $.Status "disabled"}}selected{{end}}>disabled</option>
        </select>
        <input type="submit" name="task" value="Search">
    </form>
    <table class="table table-bordered">
        <tr>
            <th>ID</th>
            <th>User</th>
            <th>Email</th>
            <th>Latest Comment</th>
        </tr>
        {{range $.Rows}}
            <tr>
                <td><a href="/admin/user/{{.Idusers}}">{{.Idusers}}</a></td>
                <td>{{.Username.String}}</td>
                <td>{{.Email.String}}</td>
                <td>{{with $c := index $.Comments .Idusers}}{{ cd.FormatLocalTime $c.CreatedAt }} - {{$c.Comment}}{{end}}</td>
            </tr>
        {{end}}
    </table>
{{ template "tail" $ }}
