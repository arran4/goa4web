// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: queries-imagebbs.sql

package db

import (
	"context"
	"database/sql"
)

const adminApproveImagePost = `-- name: AdminApproveImagePost :exec
UPDATE imagepost SET approved = 1 WHERE idimagepost = ?
`

func (q *Queries) AdminApproveImagePost(ctx context.Context, idimagepost int32) error {
	_, err := q.db.ExecContext(ctx, adminApproveImagePost, idimagepost)
	return err
}

const adminCreateImageBoard = `-- name: AdminCreateImageBoard :exec
INSERT INTO imageboard (imageboard_idimageboard, title, description, approval_required) VALUES (?, ?, ?, ?)
`

type AdminCreateImageBoardParams struct {
	ImageboardIdimageboard sql.NullInt32
	Title                  sql.NullString
	Description            sql.NullString
	ApprovalRequired       bool
}

func (q *Queries) AdminCreateImageBoard(ctx context.Context, arg AdminCreateImageBoardParams) error {
	_, err := q.db.ExecContext(ctx, adminCreateImageBoard,
		arg.ImageboardIdimageboard,
		arg.Title,
		arg.Description,
		arg.ApprovalRequired,
	)
	return err
}

const adminDeleteImageBoard = `-- name: AdminDeleteImageBoard :exec
UPDATE imageboard SET deleted_at = NOW() WHERE idimageboard = ?
`

func (q *Queries) AdminDeleteImageBoard(ctx context.Context, idimageboard int32) error {
	_, err := q.db.ExecContext(ctx, adminDeleteImageBoard, idimageboard)
	return err
}

const adminDeleteImagePost = `-- name: AdminDeleteImagePost :exec
UPDATE imagepost SET deleted_at = NOW() WHERE idimagepost = ?
`

func (q *Queries) AdminDeleteImagePost(ctx context.Context, idimagepost int32) error {
	_, err := q.db.ExecContext(ctx, adminDeleteImagePost, idimagepost)
	return err
}

const adminGetImagePost = `-- name: AdminGetImagePost :one
SELECT i.idimagepost, i.forumthread_id, i.users_idusers, i.imageboard_idimageboard, i.posted, i.timezone, i.description, i.thumbnail, i.fullimage, i.file_size, i.approved, i.deleted_at, i.last_index, u.username, th.comments
FROM imagepost i
LEFT JOIN users u ON i.users_idusers = u.idusers
LEFT JOIN forumthread th ON i.forumthread_id = th.idforumthread
WHERE i.idimagepost = ?
LIMIT 1
`

type AdminGetImagePostRow struct {
	Idimagepost            int32
	ForumthreadID          int32
	UsersIdusers           int32
	ImageboardIdimageboard sql.NullInt32
	Posted                 sql.NullTime
	Timezone               sql.NullString
	Description            sql.NullString
	Thumbnail              sql.NullString
	Fullimage              sql.NullString
	FileSize               int32
	Approved               bool
	DeletedAt              sql.NullTime
	LastIndex              sql.NullTime
	Username               sql.NullString
	Comments               sql.NullInt32
}

func (q *Queries) AdminGetImagePost(ctx context.Context, idimagepost int32) (*AdminGetImagePostRow, error) {
	row := q.db.QueryRowContext(ctx, adminGetImagePost, idimagepost)
	var i AdminGetImagePostRow
	err := row.Scan(
		&i.Idimagepost,
		&i.ForumthreadID,
		&i.UsersIdusers,
		&i.ImageboardIdimageboard,
		&i.Posted,
		&i.Timezone,
		&i.Description,
		&i.Thumbnail,
		&i.Fullimage,
		&i.FileSize,
		&i.Approved,
		&i.DeletedAt,
		&i.LastIndex,
		&i.Username,
		&i.Comments,
	)
	return &i, err
}

const adminListBoards = `-- name: AdminListBoards :many
SELECT b.idimageboard, b.imageboard_idimageboard, b.title, b.description, b.approval_required, b.deleted_at
FROM imageboard b
LIMIT ? OFFSET ?
`

type AdminListBoardsParams struct {
	Limit  int32
	Offset int32
}

func (q *Queries) AdminListBoards(ctx context.Context, arg AdminListBoardsParams) ([]*Imageboard, error) {
	rows, err := q.db.QueryContext(ctx, adminListBoards, arg.Limit, arg.Offset)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []*Imageboard
	for rows.Next() {
		var i Imageboard
		if err := rows.Scan(
			&i.Idimageboard,
			&i.ImageboardIdimageboard,
			&i.Title,
			&i.Description,
			&i.ApprovalRequired,
			&i.DeletedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, &i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const adminUpdateImageBoard = `-- name: AdminUpdateImageBoard :exec
UPDATE imageboard SET title = ?, description = ?, imageboard_idimageboard = ?, approval_required = ? WHERE idimageboard = ?
`

type AdminUpdateImageBoardParams struct {
	Title                  sql.NullString
	Description            sql.NullString
	ImageboardIdimageboard sql.NullInt32
	ApprovalRequired       bool
	Idimageboard           int32
}

func (q *Queries) AdminUpdateImageBoard(ctx context.Context, arg AdminUpdateImageBoardParams) error {
	_, err := q.db.ExecContext(ctx, adminUpdateImageBoard,
		arg.Title,
		arg.Description,
		arg.ImageboardIdimageboard,
		arg.ApprovalRequired,
		arg.Idimageboard,
	)
	return err
}

const adminUpdateImagePost = `-- name: AdminUpdateImagePost :exec
UPDATE imagepost
SET imageboard_idimageboard = ?, description = ?, approved = ?
WHERE idimagepost = ?
`

type AdminUpdateImagePostParams struct {
	ImageboardIdimageboard sql.NullInt32
	Description            sql.NullString
	Approved               bool
	Idimagepost            int32
}

func (q *Queries) AdminUpdateImagePost(ctx context.Context, arg AdminUpdateImagePostParams) error {
	_, err := q.db.ExecContext(ctx, adminUpdateImagePost,
		arg.ImageboardIdimageboard,
		arg.Description,
		arg.Approved,
		arg.Idimagepost,
	)
	return err
}

const createImagePostForPoster = `-- name: CreateImagePostForPoster :execlastid
INSERT INTO imagepost (
    imageboard_idimageboard,
    thumbnail,
    fullimage,
    users_idusers,
    description,
    posted,
    timezone,
    approved,
    file_size
)
SELECT ?, ?, ?, ?, ?, ?, ?, ?, ?
WHERE EXISTS (
    SELECT 1 FROM grants g
    WHERE g.section='imagebbs'
      AND (g.item='board' OR g.item IS NULL)
      AND g.action='post'
      AND g.active=1
      AND (g.item_id = ? OR g.item_id IS NULL)
      AND (g.user_id = ? OR g.user_id IS NULL)
      AND (g.role_id IS NULL OR g.role_id IN (
          SELECT ur.role_id FROM user_roles ur WHERE ur.users_idusers = ?
      ))
)
`

type CreateImagePostForPosterParams struct {
	ImageboardID sql.NullInt32
	Thumbnail    sql.NullString
	Fullimage    sql.NullString
	PosterID     int32
	Description  sql.NullString
	Posted       sql.NullTime
	Timezone     sql.NullString
	Approved     bool
	FileSize     int32
	GrantBoardID sql.NullInt32
	GranteeID    sql.NullInt32
}

func (q *Queries) CreateImagePostForPoster(ctx context.Context, arg CreateImagePostForPosterParams) (int64, error) {
	result, err := q.db.ExecContext(ctx, createImagePostForPoster,
		arg.ImageboardID,
		arg.Thumbnail,
		arg.Fullimage,
		arg.PosterID,
		arg.Description,
		arg.Posted,
		arg.Timezone,
		arg.Approved,
		arg.FileSize,
		arg.GrantBoardID,
		arg.GranteeID,
		arg.PosterID,
	)
	if err != nil {
		return 0, err
	}
	return result.LastInsertId()
}

const getAllImagePostsForIndex = `-- name: GetAllImagePostsForIndex :many
SELECT idimagepost, description FROM imagepost WHERE deleted_at IS NULL
`

type GetAllImagePostsForIndexRow struct {
	Idimagepost int32
	Description sql.NullString
}

func (q *Queries) GetAllImagePostsForIndex(ctx context.Context) ([]*GetAllImagePostsForIndexRow, error) {
	rows, err := q.db.QueryContext(ctx, getAllImagePostsForIndex)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []*GetAllImagePostsForIndexRow
	for rows.Next() {
		var i GetAllImagePostsForIndexRow
		if err := rows.Scan(&i.Idimagepost, &i.Description); err != nil {
			return nil, err
		}
		items = append(items, &i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getImageBoardById = `-- name: GetImageBoardById :one
SELECT idimageboard, imageboard_idimageboard, title, description, approval_required, deleted_at FROM imageboard WHERE idimageboard = ? AND deleted_at IS NULL
`

func (q *Queries) GetImageBoardById(ctx context.Context, idimageboard int32) (*Imageboard, error) {
	row := q.db.QueryRowContext(ctx, getImageBoardById, idimageboard)
	var i Imageboard
	err := row.Scan(
		&i.Idimageboard,
		&i.ImageboardIdimageboard,
		&i.Title,
		&i.Description,
		&i.ApprovalRequired,
		&i.DeletedAt,
	)
	return &i, err
}

const getImagePostByIDForLister = `-- name: GetImagePostByIDForLister :one
WITH role_ids AS (
    SELECT DISTINCT ur.role_id AS id FROM user_roles ur WHERE ur.users_idusers = ?
)
SELECT i.idimagepost, i.forumthread_id, i.users_idusers, i.imageboard_idimageboard, i.posted, i.timezone, i.description, i.thumbnail, i.fullimage, i.file_size, i.approved, i.deleted_at, i.last_index, u.username, th.comments
FROM imagepost i
LEFT JOIN users u ON i.users_idusers = u.idusers
LEFT JOIN forumthread th ON i.forumthread_id = th.idforumthread
WHERE i.idimagepost = ?
  AND i.approved = 1
  AND i.deleted_at IS NULL
  AND EXISTS (
    SELECT 1 FROM grants g
    WHERE g.section='imagebbs'
      AND (g.item='board' OR g.item IS NULL)
      AND g.action='view'
      AND g.active=1
      AND (g.item_id = i.imageboard_idimageboard OR g.item_id IS NULL)
      AND (g.user_id = ? OR g.user_id IS NULL)
      AND (g.role_id IS NULL OR g.role_id IN (SELECT id FROM role_ids))
  )
LIMIT 1
`

type GetImagePostByIDForListerParams struct {
	ListerID     int32
	ID           int32
	ListerUserID sql.NullInt32
}

type GetImagePostByIDForListerRow struct {
	Idimagepost            int32
	ForumthreadID          int32
	UsersIdusers           int32
	ImageboardIdimageboard sql.NullInt32
	Posted                 sql.NullTime
	Timezone               sql.NullString
	Description            sql.NullString
	Thumbnail              sql.NullString
	Fullimage              sql.NullString
	FileSize               int32
	Approved               bool
	DeletedAt              sql.NullTime
	LastIndex              sql.NullTime
	Username               sql.NullString
	Comments               sql.NullInt32
}

func (q *Queries) GetImagePostByIDForLister(ctx context.Context, arg GetImagePostByIDForListerParams) (*GetImagePostByIDForListerRow, error) {
	row := q.db.QueryRowContext(ctx, getImagePostByIDForLister, arg.ListerID, arg.ID, arg.ListerUserID)
	var i GetImagePostByIDForListerRow
	err := row.Scan(
		&i.Idimagepost,
		&i.ForumthreadID,
		&i.UsersIdusers,
		&i.ImageboardIdimageboard,
		&i.Posted,
		&i.Timezone,
		&i.Description,
		&i.Thumbnail,
		&i.Fullimage,
		&i.FileSize,
		&i.Approved,
		&i.DeletedAt,
		&i.LastIndex,
		&i.Username,
		&i.Comments,
	)
	return &i, err
}

const getImagePostInfoByPath = `-- name: GetImagePostInfoByPath :one
SELECT i.idimagepost, i.imageboard_idimageboard, i.users_idusers, i.posted, u.username, b.title
FROM imagepost i
LEFT JOIN users u ON i.users_idusers = u.idusers
LEFT JOIN imageboard b ON i.imageboard_idimageboard = b.idimageboard
WHERE i.fullimage = ? OR i.thumbnail = ?
LIMIT 1
`

type GetImagePostInfoByPathParams struct {
	Fullimage sql.NullString
	Thumbnail sql.NullString
}

type GetImagePostInfoByPathRow struct {
	Idimagepost            int32
	ImageboardIdimageboard sql.NullInt32
	UsersIdusers           int32
	Posted                 sql.NullTime
	Username               sql.NullString
	Title                  sql.NullString
}

func (q *Queries) GetImagePostInfoByPath(ctx context.Context, arg GetImagePostInfoByPathParams) (*GetImagePostInfoByPathRow, error) {
	row := q.db.QueryRowContext(ctx, getImagePostInfoByPath, arg.Fullimage, arg.Thumbnail)
	var i GetImagePostInfoByPathRow
	err := row.Scan(
		&i.Idimagepost,
		&i.ImageboardIdimageboard,
		&i.UsersIdusers,
		&i.Posted,
		&i.Username,
		&i.Title,
	)
	return &i, err
}

const getImagePostsByUserDescending = `-- name: GetImagePostsByUserDescending :many
SELECT i.idimagepost, i.forumthread_id, i.users_idusers, i.imageboard_idimageboard, i.posted, i.timezone, i.description, i.thumbnail, i.fullimage, i.file_size, i.approved, i.deleted_at, i.last_index, u.username, th.comments
FROM imagepost i
LEFT JOIN users u ON i.users_idusers = u.idusers
LEFT JOIN forumthread th ON i.forumthread_id = th.idforumthread
WHERE i.users_idusers = ? AND i.approved = 1 AND i.deleted_at IS NULL
ORDER BY i.posted DESC
LIMIT ? OFFSET ?
`

type GetImagePostsByUserDescendingParams struct {
	UsersIdusers int32
	Limit        int32
	Offset       int32
}

type GetImagePostsByUserDescendingRow struct {
	Idimagepost            int32
	ForumthreadID          int32
	UsersIdusers           int32
	ImageboardIdimageboard sql.NullInt32
	Posted                 sql.NullTime
	Timezone               sql.NullString
	Description            sql.NullString
	Thumbnail              sql.NullString
	Fullimage              sql.NullString
	FileSize               int32
	Approved               bool
	DeletedAt              sql.NullTime
	LastIndex              sql.NullTime
	Username               sql.NullString
	Comments               sql.NullInt32
}

func (q *Queries) GetImagePostsByUserDescending(ctx context.Context, arg GetImagePostsByUserDescendingParams) ([]*GetImagePostsByUserDescendingRow, error) {
	rows, err := q.db.QueryContext(ctx, getImagePostsByUserDescending, arg.UsersIdusers, arg.Limit, arg.Offset)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []*GetImagePostsByUserDescendingRow
	for rows.Next() {
		var i GetImagePostsByUserDescendingRow
		if err := rows.Scan(
			&i.Idimagepost,
			&i.ForumthreadID,
			&i.UsersIdusers,
			&i.ImageboardIdimageboard,
			&i.Posted,
			&i.Timezone,
			&i.Description,
			&i.Thumbnail,
			&i.Fullimage,
			&i.FileSize,
			&i.Approved,
			&i.DeletedAt,
			&i.LastIndex,
			&i.Username,
			&i.Comments,
		); err != nil {
			return nil, err
		}
		items = append(items, &i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getImagePostsByUserDescendingAll = `-- name: GetImagePostsByUserDescendingAll :many
SELECT i.idimagepost, i.forumthread_id, i.users_idusers, i.imageboard_idimageboard, i.posted, i.timezone, i.description, i.thumbnail, i.fullimage, i.file_size, i.approved, i.deleted_at, i.last_index, u.username, th.comments
FROM imagepost i
LEFT JOIN users u ON i.users_idusers = u.idusers
LEFT JOIN forumthread th ON i.forumthread_id = th.idforumthread
WHERE i.users_idusers = ? AND i.deleted_at IS NULL
ORDER BY i.posted DESC
LIMIT ? OFFSET ?
`

type GetImagePostsByUserDescendingAllParams struct {
	UsersIdusers int32
	Limit        int32
	Offset       int32
}

type GetImagePostsByUserDescendingAllRow struct {
	Idimagepost            int32
	ForumthreadID          int32
	UsersIdusers           int32
	ImageboardIdimageboard sql.NullInt32
	Posted                 sql.NullTime
	Timezone               sql.NullString
	Description            sql.NullString
	Thumbnail              sql.NullString
	Fullimage              sql.NullString
	FileSize               int32
	Approved               bool
	DeletedAt              sql.NullTime
	LastIndex              sql.NullTime
	Username               sql.NullString
	Comments               sql.NullInt32
}

func (q *Queries) GetImagePostsByUserDescendingAll(ctx context.Context, arg GetImagePostsByUserDescendingAllParams) ([]*GetImagePostsByUserDescendingAllRow, error) {
	rows, err := q.db.QueryContext(ctx, getImagePostsByUserDescendingAll, arg.UsersIdusers, arg.Limit, arg.Offset)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []*GetImagePostsByUserDescendingAllRow
	for rows.Next() {
		var i GetImagePostsByUserDescendingAllRow
		if err := rows.Scan(
			&i.Idimagepost,
			&i.ForumthreadID,
			&i.UsersIdusers,
			&i.ImageboardIdimageboard,
			&i.Posted,
			&i.Timezone,
			&i.Description,
			&i.Thumbnail,
			&i.Fullimage,
			&i.FileSize,
			&i.Approved,
			&i.DeletedAt,
			&i.LastIndex,
			&i.Username,
			&i.Comments,
		); err != nil {
			return nil, err
		}
		items = append(items, &i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listBoardsByParentIDForLister = `-- name: ListBoardsByParentIDForLister :many
WITH role_ids AS (
    SELECT DISTINCT ur.role_id AS id FROM user_roles ur WHERE ur.users_idusers = ?
)
SELECT b.idimageboard, b.imageboard_idimageboard, b.title, b.description, b.approval_required, b.deleted_at
FROM imageboard b
WHERE (b.imageboard_idimageboard = ? OR (b.imageboard_idimageboard IS NULL AND ? IS NULL))
  AND b.deleted_at IS NULL
  AND EXISTS (
    SELECT 1 FROM grants g
    WHERE g.section='imagebbs'
      AND (g.item='board' OR g.item IS NULL)
      AND g.action='see'
      AND g.active=1
      AND (g.item_id = b.idimageboard OR g.item_id IS NULL)
      AND (g.user_id = ? OR g.user_id IS NULL)
      AND (g.role_id IS NULL OR g.role_id IN (SELECT id FROM role_ids))
  )
LIMIT ? OFFSET ?
`

type ListBoardsByParentIDForListerParams struct {
	ListerID     int32
	ParentID     sql.NullInt32
	ListerUserID sql.NullInt32
	Limit        int32
	Offset       int32
}

func (q *Queries) ListBoardsByParentIDForLister(ctx context.Context, arg ListBoardsByParentIDForListerParams) ([]*Imageboard, error) {
	rows, err := q.db.QueryContext(ctx, listBoardsByParentIDForLister,
		arg.ListerID,
		arg.ParentID,
		arg.ParentID,
		arg.ListerUserID,
		arg.Limit,
		arg.Offset,
	)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []*Imageboard
	for rows.Next() {
		var i Imageboard
		if err := rows.Scan(
			&i.Idimageboard,
			&i.ImageboardIdimageboard,
			&i.Title,
			&i.Description,
			&i.ApprovalRequired,
			&i.DeletedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, &i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listBoardsForLister = `-- name: ListBoardsForLister :many
WITH role_ids AS (
    SELECT DISTINCT ur.role_id AS id FROM user_roles ur WHERE ur.users_idusers = ?
)
SELECT b.idimageboard, b.imageboard_idimageboard, b.title, b.description, b.approval_required, b.deleted_at
FROM imageboard b
WHERE b.deleted_at IS NULL AND EXISTS (
    SELECT 1 FROM grants g
    WHERE g.section='imagebbs'
      AND (g.item='board' OR g.item IS NULL)
      AND g.action='see'
      AND g.active=1
      AND (g.item_id = b.idimageboard OR g.item_id IS NULL)
      AND (g.user_id = ? OR g.user_id IS NULL)
      AND (g.role_id IS NULL OR g.role_id IN (SELECT id FROM role_ids))
  )
LIMIT ? OFFSET ?
`

type ListBoardsForListerParams struct {
	ListerID     int32
	ListerUserID sql.NullInt32
	Limit        int32
	Offset       int32
}

func (q *Queries) ListBoardsForLister(ctx context.Context, arg ListBoardsForListerParams) ([]*Imageboard, error) {
	rows, err := q.db.QueryContext(ctx, listBoardsForLister,
		arg.ListerID,
		arg.ListerUserID,
		arg.Limit,
		arg.Offset,
	)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []*Imageboard
	for rows.Next() {
		var i Imageboard
		if err := rows.Scan(
			&i.Idimageboard,
			&i.ImageboardIdimageboard,
			&i.Title,
			&i.Description,
			&i.ApprovalRequired,
			&i.DeletedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, &i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listImagePostsByBoardForLister = `-- name: ListImagePostsByBoardForLister :many
WITH role_ids AS (
    SELECT DISTINCT ur.role_id AS id FROM user_roles ur WHERE ur.users_idusers = ?
)
SELECT i.idimagepost, i.forumthread_id, i.users_idusers, i.imageboard_idimageboard, i.posted, i.timezone, i.description, i.thumbnail, i.fullimage, i.file_size, i.approved, i.deleted_at, i.last_index, u.username, th.comments
FROM imagepost i
LEFT JOIN users u ON i.users_idusers = u.idusers
LEFT JOIN forumthread th ON i.forumthread_id = th.idforumthread
WHERE i.imageboard_idimageboard = ?
  AND i.approved = 1
  AND i.deleted_at IS NULL
  AND EXISTS (
    SELECT 1 FROM grants g
    WHERE g.section='imagebbs'
      AND (g.item='board' OR g.item IS NULL)
      AND g.action='view'
      AND g.active=1
      AND (g.item_id = i.imageboard_idimageboard OR g.item_id IS NULL)
      AND (g.user_id = ? OR g.user_id IS NULL)
      AND (g.role_id IS NULL OR g.role_id IN (SELECT id FROM role_ids))
  )
LIMIT ? OFFSET ?
`

type ListImagePostsByBoardForListerParams struct {
	ListerID     int32
	BoardID      sql.NullInt32
	ListerUserID sql.NullInt32
	Limit        int32
	Offset       int32
}

type ListImagePostsByBoardForListerRow struct {
	Idimagepost            int32
	ForumthreadID          int32
	UsersIdusers           int32
	ImageboardIdimageboard sql.NullInt32
	Posted                 sql.NullTime
	Timezone               sql.NullString
	Description            sql.NullString
	Thumbnail              sql.NullString
	Fullimage              sql.NullString
	FileSize               int32
	Approved               bool
	DeletedAt              sql.NullTime
	LastIndex              sql.NullTime
	Username               sql.NullString
	Comments               sql.NullInt32
}

func (q *Queries) ListImagePostsByBoardForLister(ctx context.Context, arg ListImagePostsByBoardForListerParams) ([]*ListImagePostsByBoardForListerRow, error) {
	rows, err := q.db.QueryContext(ctx, listImagePostsByBoardForLister,
		arg.ListerID,
		arg.BoardID,
		arg.ListerUserID,
		arg.Limit,
		arg.Offset,
	)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []*ListImagePostsByBoardForListerRow
	for rows.Next() {
		var i ListImagePostsByBoardForListerRow
		if err := rows.Scan(
			&i.Idimagepost,
			&i.ForumthreadID,
			&i.UsersIdusers,
			&i.ImageboardIdimageboard,
			&i.Posted,
			&i.Timezone,
			&i.Description,
			&i.Thumbnail,
			&i.Fullimage,
			&i.FileSize,
			&i.Approved,
			&i.DeletedAt,
			&i.LastIndex,
			&i.Username,
			&i.Comments,
		); err != nil {
			return nil, err
		}
		items = append(items, &i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listImagePostsByPosterForLister = `-- name: ListImagePostsByPosterForLister :many
WITH role_ids AS (
    SELECT DISTINCT ur.role_id AS id FROM user_roles ur WHERE ur.users_idusers = ?
)
SELECT i.idimagepost, i.forumthread_id, i.users_idusers, i.imageboard_idimageboard, i.posted, i.timezone, i.description, i.thumbnail, i.fullimage, i.file_size, i.approved, i.deleted_at, i.last_index, u.username, th.comments
FROM imagepost i
LEFT JOIN users u ON i.users_idusers = u.idusers
LEFT JOIN forumthread th ON i.forumthread_id = th.idforumthread
WHERE i.users_idusers = ?
  AND i.approved = 1
  AND i.deleted_at IS NULL
  AND EXISTS (
    SELECT 1 FROM grants g
    WHERE g.section='imagebbs'
      AND (g.item='board' OR g.item IS NULL)
      AND g.action='see'
      AND g.active=1
      AND (g.item_id = i.imageboard_idimageboard OR g.item_id IS NULL)
      AND (g.user_id = ? OR g.user_id IS NULL)
      AND (g.role_id IS NULL OR g.role_id IN (SELECT id FROM role_ids))
  )
ORDER BY i.posted DESC
LIMIT ? OFFSET ?
`

type ListImagePostsByPosterForListerParams struct {
	ListerID     int32
	PosterID     int32
	ListerUserID sql.NullInt32
	Limit        int32
	Offset       int32
}

type ListImagePostsByPosterForListerRow struct {
	Idimagepost            int32
	ForumthreadID          int32
	UsersIdusers           int32
	ImageboardIdimageboard sql.NullInt32
	Posted                 sql.NullTime
	Timezone               sql.NullString
	Description            sql.NullString
	Thumbnail              sql.NullString
	Fullimage              sql.NullString
	FileSize               int32
	Approved               bool
	DeletedAt              sql.NullTime
	LastIndex              sql.NullTime
	Username               sql.NullString
	Comments               sql.NullInt32
}

func (q *Queries) ListImagePostsByPosterForLister(ctx context.Context, arg ListImagePostsByPosterForListerParams) ([]*ListImagePostsByPosterForListerRow, error) {
	rows, err := q.db.QueryContext(ctx, listImagePostsByPosterForLister,
		arg.ListerID,
		arg.PosterID,
		arg.ListerUserID,
		arg.Limit,
		arg.Offset,
	)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []*ListImagePostsByPosterForListerRow
	for rows.Next() {
		var i ListImagePostsByPosterForListerRow
		if err := rows.Scan(
			&i.Idimagepost,
			&i.ForumthreadID,
			&i.UsersIdusers,
			&i.ImageboardIdimageboard,
			&i.Posted,
			&i.Timezone,
			&i.Description,
			&i.Thumbnail,
			&i.Fullimage,
			&i.FileSize,
			&i.Approved,
			&i.DeletedAt,
			&i.LastIndex,
			&i.Username,
			&i.Comments,
		); err != nil {
			return nil, err
		}
		items = append(items, &i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listImageboardPath = `-- name: ListImageboardPath :many
WITH RECURSIVE board_path AS (
    SELECT b.idimageboard, b.imageboard_idimageboard AS parent_id, b.title, 0 AS depth
    FROM imageboard b
    WHERE b.idimageboard = ?
    UNION ALL
    SELECT b2.idimageboard, b2.imageboard_idimageboard, b2.title, p.depth + 1
    FROM imageboard b2
    JOIN board_path p ON p.parent_id = b2.idimageboard
)
SELECT board_path.idimageboard, board_path.title
FROM board_path
ORDER BY board_path.depth DESC
`

type ListImageboardPathRow struct {
	Idimageboard int32
	Title        sql.NullString
}

func (q *Queries) ListImageboardPath(ctx context.Context, boardID int32) ([]*ListImageboardPathRow, error) {
	rows, err := q.db.QueryContext(ctx, listImageboardPath, boardID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []*ListImageboardPathRow
	for rows.Next() {
		var i ListImageboardPathRow
		if err := rows.Scan(&i.Idimageboard, &i.Title); err != nil {
			return nil, err
		}
		items = append(items, &i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const systemAssignImagePostThreadID = `-- name: SystemAssignImagePostThreadID :exec
UPDATE imagepost SET forumthread_id = ? WHERE idimagepost = ?
`

type SystemAssignImagePostThreadIDParams struct {
	ForumthreadID int32
	Idimagepost   int32
}

func (q *Queries) SystemAssignImagePostThreadID(ctx context.Context, arg SystemAssignImagePostThreadIDParams) error {
	_, err := q.db.ExecContext(ctx, systemAssignImagePostThreadID, arg.ForumthreadID, arg.Idimagepost)
	return err
}

const systemListBoardsByParentID = `-- name: SystemListBoardsByParentID :many
SELECT b.idimageboard, b.imageboard_idimageboard, b.title, b.description, b.approval_required, b.deleted_at
FROM imageboard b
WHERE (b.imageboard_idimageboard = ? OR (b.imageboard_idimageboard IS NULL AND ? IS NULL))
  AND b.deleted_at IS NULL
LIMIT ? OFFSET ?
`

type SystemListBoardsByParentIDParams struct {
	ParentID sql.NullInt32
	Limit    int32
	Offset   int32
}

func (q *Queries) SystemListBoardsByParentID(ctx context.Context, arg SystemListBoardsByParentIDParams) ([]*Imageboard, error) {
	rows, err := q.db.QueryContext(ctx, systemListBoardsByParentID,
		arg.ParentID,
		arg.ParentID,
		arg.Limit,
		arg.Offset,
	)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []*Imageboard
	for rows.Next() {
		var i Imageboard
		if err := rows.Scan(
			&i.Idimageboard,
			&i.ImageboardIdimageboard,
			&i.Title,
			&i.Description,
			&i.ApprovalRequired,
			&i.DeletedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, &i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const systemSetImagePostLastIndex = `-- name: SystemSetImagePostLastIndex :exec
UPDATE imagepost SET last_index = NOW() WHERE idimagepost = ?
`

func (q *Queries) SystemSetImagePostLastIndex(ctx context.Context, idimagepost int32) error {
	_, err := q.db.ExecContext(ctx, systemSetImagePostLastIndex, idimagepost)
	return err
}
