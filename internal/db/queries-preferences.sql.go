// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: queries-preferences.sql

package db

import (
	"context"
	"database/sql"
)

const getPreferenceForLister = `-- name: GetPreferenceForLister :one
SELECT idpreferences, language_id, users_idusers, emailforumupdates, page_size, auto_subscribe_replies, timezone, custom_css, daily_digest_hour, daily_digest_mark_read, last_digest_sent_at
FROM preferences
WHERE users_idusers = ?
`

func (q *Queries) GetPreferenceForLister(ctx context.Context, listerID int32) (*Preference, error) {
	row := q.db.QueryRowContext(ctx, getPreferenceForLister, listerID)
	var i Preference
	err := row.Scan(
		&i.Idpreferences,
		&i.LanguageID,
		&i.UsersIdusers,
		&i.Emailforumupdates,
		&i.PageSize,
		&i.AutoSubscribeReplies,
		&i.Timezone,
		&i.CustomCss,
		&i.DailyDigestHour,
		&i.DailyDigestMarkRead,
		&i.LastDigestSentAt,
	)
	return &i, err
}

const getUsersForDailyDigest = `-- name: GetUsersForDailyDigest :many
SELECT p.users_idusers, ue.email, p.daily_digest_mark_read
FROM preferences p
JOIN user_emails ue ON ue.id = (
    SELECT id FROM user_emails ue2
    WHERE ue2.user_id = p.users_idusers AND ue2.verified_at IS NOT NULL
    ORDER BY ue2.notification_priority DESC, ue2.id LIMIT 1
)
WHERE p.daily_digest_hour = ?
  AND (p.last_digest_sent_at IS NULL OR p.last_digest_sent_at < ?)
`

type GetUsersForDailyDigestParams struct {
	Hour   sql.NullInt32
	Cutoff sql.NullTime
}

type GetUsersForDailyDigestRow struct {
	UsersIdusers        int32
	Email               string
	DailyDigestMarkRead bool
}

func (q *Queries) GetUsersForDailyDigest(ctx context.Context, arg GetUsersForDailyDigestParams) ([]*GetUsersForDailyDigestRow, error) {
	rows, err := q.db.QueryContext(ctx, getUsersForDailyDigest, arg.Hour, arg.Cutoff)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []*GetUsersForDailyDigestRow
	for rows.Next() {
		var i GetUsersForDailyDigestRow
		if err := rows.Scan(&i.UsersIdusers, &i.Email, &i.DailyDigestMarkRead); err != nil {
			return nil, err
		}
		items = append(items, &i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const insertEmailPreferenceForLister = `-- name: InsertEmailPreferenceForLister :exec
INSERT INTO preferences (emailforumupdates, auto_subscribe_replies, users_idusers)
VALUES (?, ?, ?)
`

type InsertEmailPreferenceForListerParams struct {
	EmailForumUpdates    sql.NullBool
	AutoSubscribeReplies bool
	ListerID             int32
}

func (q *Queries) InsertEmailPreferenceForLister(ctx context.Context, arg InsertEmailPreferenceForListerParams) error {
	_, err := q.db.ExecContext(ctx, insertEmailPreferenceForLister, arg.EmailForumUpdates, arg.AutoSubscribeReplies, arg.ListerID)
	return err
}

const insertPreferenceForLister = `-- name: InsertPreferenceForLister :exec
INSERT INTO preferences (language_id, users_idusers, page_size, timezone)
VALUES (?, ?, ?, ?)
`

type InsertPreferenceForListerParams struct {
	LanguageID sql.NullInt32
	ListerID   int32
	PageSize   int32
	Timezone   sql.NullString
}

func (q *Queries) InsertPreferenceForLister(ctx context.Context, arg InsertPreferenceForListerParams) error {
	_, err := q.db.ExecContext(ctx, insertPreferenceForLister,
		arg.LanguageID,
		arg.ListerID,
		arg.PageSize,
		arg.Timezone,
	)
	return err
}

const updateAutoSubscribeRepliesForLister = `-- name: UpdateAutoSubscribeRepliesForLister :exec
UPDATE preferences
SET auto_subscribe_replies = ?
WHERE users_idusers = ?
`

type UpdateAutoSubscribeRepliesForListerParams struct {
	AutoSubscribeReplies bool
	ListerID             int32
}

func (q *Queries) UpdateAutoSubscribeRepliesForLister(ctx context.Context, arg UpdateAutoSubscribeRepliesForListerParams) error {
	_, err := q.db.ExecContext(ctx, updateAutoSubscribeRepliesForLister, arg.AutoSubscribeReplies, arg.ListerID)
	return err
}

const updateCustomCssForLister = `-- name: UpdateCustomCssForLister :exec
UPDATE preferences
SET custom_css = ?
WHERE users_idusers = ?
`

type UpdateCustomCssForListerParams struct {
	CustomCss sql.NullString
	ListerID  int32
}

func (q *Queries) UpdateCustomCssForLister(ctx context.Context, arg UpdateCustomCssForListerParams) error {
	_, err := q.db.ExecContext(ctx, updateCustomCssForLister, arg.CustomCss, arg.ListerID)
	return err
}

const updateEmailForumUpdatesForLister = `-- name: UpdateEmailForumUpdatesForLister :exec
UPDATE preferences
SET emailforumupdates = ?
WHERE users_idusers = ?
`

type UpdateEmailForumUpdatesForListerParams struct {
	EmailForumUpdates sql.NullBool
	ListerID          int32
}

func (q *Queries) UpdateEmailForumUpdatesForLister(ctx context.Context, arg UpdateEmailForumUpdatesForListerParams) error {
	_, err := q.db.ExecContext(ctx, updateEmailForumUpdatesForLister, arg.EmailForumUpdates, arg.ListerID)
	return err
}

const updateLastDigestSentAt = `-- name: UpdateLastDigestSentAt :exec
UPDATE preferences
SET last_digest_sent_at = ?
WHERE users_idusers = ?
`

type UpdateLastDigestSentAtParams struct {
	SentAt   sql.NullTime
	ListerID int32
}

func (q *Queries) UpdateLastDigestSentAt(ctx context.Context, arg UpdateLastDigestSentAtParams) error {
	_, err := q.db.ExecContext(ctx, updateLastDigestSentAt, arg.SentAt, arg.ListerID)
	return err
}

const updateNotificationDigestPreferences = `-- name: UpdateNotificationDigestPreferences :exec
UPDATE preferences
SET daily_digest_hour = ?,
    daily_digest_mark_read = ?
WHERE users_idusers = ?
`

type UpdateNotificationDigestPreferencesParams struct {
	DailyDigestHour     sql.NullInt32
	DailyDigestMarkRead bool
	ListerID            int32
}

func (q *Queries) UpdateNotificationDigestPreferences(ctx context.Context, arg UpdateNotificationDigestPreferencesParams) error {
	_, err := q.db.ExecContext(ctx, updateNotificationDigestPreferences, arg.DailyDigestHour, arg.DailyDigestMarkRead, arg.ListerID)
	return err
}

const updatePreferenceForLister = `-- name: UpdatePreferenceForLister :exec
UPDATE preferences SET language_id = ?, page_size = ?, timezone = ? WHERE users_idusers = ?
`

type UpdatePreferenceForListerParams struct {
	LanguageID sql.NullInt32
	PageSize   int32
	Timezone   sql.NullString
	ListerID   int32
}

func (q *Queries) UpdatePreferenceForLister(ctx context.Context, arg UpdatePreferenceForListerParams) error {
	_, err := q.db.ExecContext(ctx, updatePreferenceForLister,
		arg.LanguageID,
		arg.PageSize,
		arg.Timezone,
		arg.ListerID,
	)
	return err
}

const updateTimezoneForLister = `-- name: UpdateTimezoneForLister :exec
UPDATE preferences
SET timezone = ?
WHERE users_idusers = ?
`

type UpdateTimezoneForListerParams struct {
	Timezone sql.NullString
	ListerID int32
}

func (q *Queries) UpdateTimezoneForLister(ctx context.Context, arg UpdateTimezoneForListerParams) error {
	_, err := q.db.ExecContext(ctx, updateTimezoneForLister, arg.Timezone, arg.ListerID)
	return err
}
