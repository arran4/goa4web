// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: queries-private_forum.sql

package db

import (
	"context"
	"database/sql"
)

const adminListAllPrivateForumThreads = `-- name: AdminListAllPrivateForumThreads :many
SELECT
    t.idforumthread,
    t.forumtopic_idforumtopic as idforumtopic,
    COALESCE(SUBSTRING(c.text, 1, 100), 'unknown') AS title,
    c.written as created_at,
    c.users_idusers as created_by,
    t.lastposter as last_post_by,
    t.lastaddition as last_post_at,
    t.comments as post_count,
    COALESCE(ft.title, '') as topic_title
FROM
    forumthread t
JOIN
    forumtopic ft ON t.forumtopic_idforumtopic = ft.idforumtopic
JOIN
    comments c ON t.firstpost = c.idcomments
WHERE
    ft.handler = 'private'
`

type AdminListAllPrivateForumThreadsRow struct {
	Idforumthread int32
	Idforumtopic  int32
	Title         interface{}
	CreatedAt     sql.NullTime
	CreatedBy     int32
	LastPostBy    int32
	LastPostAt    sql.NullTime
	PostCount     sql.NullInt32
	TopicTitle    string
}

func (q *Queries) AdminListAllPrivateForumThreads(ctx context.Context) ([]*AdminListAllPrivateForumThreadsRow, error) {
	rows, err := q.db.QueryContext(ctx, adminListAllPrivateForumThreads)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []*AdminListAllPrivateForumThreadsRow
	for rows.Next() {
		var i AdminListAllPrivateForumThreadsRow
		if err := rows.Scan(
			&i.Idforumthread,
			&i.Idforumtopic,
			&i.Title,
			&i.CreatedAt,
			&i.CreatedBy,
			&i.LastPostBy,
			&i.LastPostAt,
			&i.PostCount,
			&i.TopicTitle,
		); err != nil {
			return nil, err
		}
		items = append(items, &i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const adminListAllPrivateTopics = `-- name: AdminListAllPrivateTopics :many
SELECT
    idforumtopic,
    COALESCE(title, '') AS title,
    lastposter AS last_post_by,
    lastaddition AS last_post_at,
    comments AS post_count
FROM
    forumtopic
WHERE
    handler = 'private'
`

type AdminListAllPrivateTopicsRow struct {
	Idforumtopic int32
	Title        string
	LastPostBy   int32
	LastPostAt   sql.NullTime
	PostCount    sql.NullInt32
}

func (q *Queries) AdminListAllPrivateTopics(ctx context.Context) ([]*AdminListAllPrivateTopicsRow, error) {
	rows, err := q.db.QueryContext(ctx, adminListAllPrivateTopics)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []*AdminListAllPrivateTopicsRow
	for rows.Next() {
		var i AdminListAllPrivateTopicsRow
		if err := rows.Scan(
			&i.Idforumtopic,
			&i.Title,
			&i.LastPostBy,
			&i.LastPostAt,
			&i.PostCount,
		); err != nil {
			return nil, err
		}
		items = append(items, &i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const adminListGrantsByThreadID = `-- name: AdminListGrantsByThreadID :many
SELECT
    g.id,
    g.section,
    g.action,
    r.name AS role_name,
    u.username
FROM
    grants g
LEFT JOIN
    roles r ON g.role_id = r.id
LEFT JOIN
    users u ON g.user_id = u.idusers
WHERE
    g.section = 'privateforum_thread' AND g.item_id = ?
`

type AdminListGrantsByThreadIDRow struct {
	ID       int32
	Section  string
	Action   string
	RoleName sql.NullString
	Username sql.NullString
}

func (q *Queries) AdminListGrantsByThreadID(ctx context.Context, itemID sql.NullInt32) ([]*AdminListGrantsByThreadIDRow, error) {
	rows, err := q.db.QueryContext(ctx, adminListGrantsByThreadID, itemID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []*AdminListGrantsByThreadIDRow
	for rows.Next() {
		var i AdminListGrantsByThreadIDRow
		if err := rows.Scan(
			&i.ID,
			&i.Section,
			&i.Action,
			&i.RoleName,
			&i.Username,
		); err != nil {
			return nil, err
		}
		items = append(items, &i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const adminListGrantsByTopicID = `-- name: AdminListGrantsByTopicID :many
SELECT
    g.id,
    g.section,
    g.action,
    r.name AS role_name,
    u.username
FROM
    grants g
LEFT JOIN
    roles r ON g.role_id = r.id
LEFT JOIN
    users u ON g.user_id = u.idusers
WHERE
    g.section = 'privateforum' AND g.item_id = ?
`

type AdminListGrantsByTopicIDRow struct {
	ID       int32
	Section  string
	Action   string
	RoleName sql.NullString
	Username sql.NullString
}

func (q *Queries) AdminListGrantsByTopicID(ctx context.Context, itemID sql.NullInt32) ([]*AdminListGrantsByTopicIDRow, error) {
	rows, err := q.db.QueryContext(ctx, adminListGrantsByTopicID, itemID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []*AdminListGrantsByTopicIDRow
	for rows.Next() {
		var i AdminListGrantsByTopicIDRow
		if err := rows.Scan(
			&i.ID,
			&i.Section,
			&i.Action,
			&i.RoleName,
			&i.Username,
		); err != nil {
			return nil, err
		}
		items = append(items, &i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}
