# Query Naming Specification

This document defines the naming conventions for SQL queries and the corresponding
Go wrappers generated by `sqlc`.

## Role prefixes

All query names must begin with a prefix indicating the required role:

- `System` – internal operations run without a user context. These
  queries are suitable for CLI commands and must never require a user ID.
- `Admin` – administrative operations; must not require a user ID.
- `List`/`Get` – user facing operations. User commands include the
  required role using a `For<Role>` suffix (for example `ForLister`,
  `ForWriter`, `ForCommenter`, `ForReplier`). Parameter names should
  mirror the role and use the `<Role>ID` form (e.g. `ListerID`,
  `WriterID`). When a clearer role name exists (`Writer`, `Lister`,
  `Commenter`, `Replier`, etc.) it should be used. Historic `See`/`Seer`
  terminology is replaced by `List`/`Lister`.

## Lists

Queries returning multiple rows must start with the `List` prefix and
include pagination (`LIMIT`/`OFFSET`). User and admin lists must respect
each user's pagination and language preferences and enforce permissions
within the SQL itself. Admin and system queries must never require a user
ID.

Admin queries are always prefixed with `Admin` and must omit any user ID
parameters. System-level operations invoked from CLI tools or background
workers use the `System` prefix and likewise must not depend on a user ID.

## Grants

User queries should check grants both in SQL and in Go code to ensure
authorisation rules are enforced. Admin and system queries should not
require a user ID and are intended for privileged operations.

These rules are verified by tests and should be followed for all new
queries.

## Additional rules

- Admin and system commands used by CLI tools or background workers must use
  the `System` or `Admin` prefix and must never accept a user ID.
- Internal bookkeeping operations (for example assigning thread IDs) use
  the `System` prefix with a descriptive verb, e.g.
  `SystemAssignBlogEntryThreadID`.
- User-facing queries include the required role in the function name using a
  `For<Role>` suffix and matching `<Role>ID` parameters. Prefer descriptive role
  names such as `Writer`, `Lister`, `Commenter`, or `Replier`.
- The legacy `See`/`Seer` terminology is replaced by `List`/`Lister`.
- All list queries paginate with both `LIMIT` and `OFFSET`. User and admin lists
  must apply the caller's pagination and language settings.
- User queries should validate grants in SQL and again in Go code for defence in
  depth.

## Custom queries

Queries that cannot be represented as static SQL should be defined on the
`CustomQueries` interface. The generated `Queries` type must not expose the
underlying database handle (previously available via `DB()`). If a custom
query can be implemented as a normal query without significant runtime cost,
prefer adding it as a standard query instead of using `CustomQueries`.
